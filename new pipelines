SELECT 
    'SurveillanceRun' as TableName,
    COLUMN_NAME,
    DATA_TYPE,
    IS_NULLABLE,
    COLUMN_DEFAULT,
    COLUMNPROPERTY(OBJECT_ID('ccams.SurveillanceRun'), COLUMN_NAME, 'IsIdentity') as IsAutoIncrement
FROM INFORMATION_SCHEMA.COLUMNS 
WHERE TABLE_NAME = 'SurveillanceRun'
  AND TABLE_SCHEMA = 'ccams'
  AND COLUMN_NAME IN ('SurveillanceRunId', 'Id', 'SurveillanceId')

EXEC [dbo].[sp_CheckTDRLoadstatusview] @lv_batchid = '20250614'

-- First get the process date (T-2)
DECLARE @return_value varchar(100)
DECLARE @RUNProcessDate varchar(100) 
DECLARE @ProcessDate varchar(100)

EXEC [dbo].[sp_BusinessDateT-2] 
    @RUNProcessDate OUTPUT, 
    @ProcessDate OUTPUT

-- Now check TDR load status using the calculated date
EXEC [dbo].[sp_CheckTDRLoadstatusview] @lv_batchid = @ProcessDate

-- Show what date was used
SELECT @ProcessDate as ProcessDateUsed

SELECT 
    COUNT(*) as RecordCount,
    CASE 
        WHEN COUNT(*) > 0 THEN 'TRUE' 
        ELSE 'FALSE' 
    END as Result
FROM [dbo].[CONDUCT_DERIVATIVES_PRE_STG] 
WHERE BatchId = '20250612'

SELECT CASE WHEN COUNT(*) > 0 THEN 'TRUE' ELSE 'FALSE' END as Result FROM [dbo].[CONDUCT_DERIVATIVES_PRE_STG] WHERE BatchId = '20250612'
