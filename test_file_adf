{
  "name": "Test_THROW_Pipeline",
  "properties": {
    "description": "Test pipeline to demonstrate THROW statement failure mechanism",
    "variables": {
      "LoadCount": {
        "type": "String",
        "defaultValue": "3"
      },
      "ExpectedCount": {
        "type": "String",
        "defaultValue": "4"
      }
    },
    "activities": [
      {
        "name": "Check_Load_Count",
        "type": "IfCondition",
        "dependsOn": [],
        "typeProperties": {
          "expression": {
            "value": "@greaterOrEquals(int(variables('LoadCount')), int(variables('ExpectedCount')))",
            "type": "Expression"
          },
          "ifTrueActivities": [
            {
              "name": "Success_Path",
              "type": "SetVariable",
              "dependsOn": [],
              "policy": {
                "secureOutput": false,
                "secureInput": false
              },
              "typeProperties": {
                "variableName": "LoadCount",
                "value": {
                  "value": "SUCCESS: All @{variables('ExpectedCount')} loads are available",
                  "type": "Expression"
                }
              }
            }
          ],
          "ifFalseActivities": [
            {
              "name": "Force_Pipeline_Failure_TEST",
              "type": "Fail",
              "dependsOn": [],
              "typeProperties": {
                "message": "THROW 50000: TDR Load conditions not met - Pipeline terminated",
                "errorCode": "50000"
              }
            }
          ]
        }
      }
    ]
  }
}
