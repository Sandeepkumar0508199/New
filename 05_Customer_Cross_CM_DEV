# Convert final alerts to JSON for ADF (ADD THIS AT THE VERY END)
try:
    if not alert_df.empty:
        # Convert Pandas DataFrame to JSON
        final_alerts_json = alert_df.to_json(orient='records')
        print(f"âœ… Generated {len(alert_df)} Customer Cross alerts for output")
        print(f"ğŸ“‹ Sample alert data: {final_alerts_json[:200]}...")
    else:
        final_alerts_json = "[]"
        print("ğŸ“‹ No Customer Cross alerts generated")
    
    print("ğŸ¯ Customer Cross Detection completed - sending results to ADF")
    dbutils.notebook.exit(final_alerts_json)
    
except Exception as e:
    print(f"âŒ Error preparing output: {e}")
    print("ğŸ“‹ Sending empty result to ADF")
    dbutils.notebook.exit("[]")
