# Convert final alerts to JSON for ADF (ADD THIS AT THE VERY END)
try:
    if not alert_df.empty:
        # Convert Pandas DataFrame to JSON
        final_alerts_json = alert_df.to_json(orient='records')
        print(f"✅ Generated {len(alert_df)} Customer Cross alerts for output")
        print(f"📋 Sample alert data: {final_alerts_json[:200]}...")
    else:
        final_alerts_json = "[]"
        print("📋 No Customer Cross alerts generated")
    
    print("🎯 Customer Cross Detection completed - sending results to ADF")
    dbutils.notebook.exit(final_alerts_json)
    
except Exception as e:
    print(f"❌ Error preparing output: {e}")
    print("📋 Sending empty result to ADF")
    dbutils.notebook.exit("[]")
